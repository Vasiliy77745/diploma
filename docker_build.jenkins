#!groovy
// Run docker build
properties([disableConcurrentBuilds()])

pipeline {
    agent { 
        label 'master'
        }
    triggers { pollSCM('* * * * *') }
    options {
        timestamps()
    }
    stages {
        stage("docker build and push") {
            steps {
                script {
                    dir("${pwd()}/docker/toolbox") {
                        docker.withRegistry('https://registry.hub.docker.com','docker_hub_alexv77745') {
                            def sha = env.GIT_COMMIT.substring(0,8)
                            def image = docker.build("alexv77745/diploma:${env.GIT_BRANCH}-${sha}")
                            sh 'printenv'
                            image.push()
                            image.push('latest')
                        }
                    }
                }
            }
        }
    }
}    
